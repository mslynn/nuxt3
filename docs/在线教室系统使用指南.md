# 🎓 智启在线教室系统 - 使用指南

一个基于 **Nuxt3 + WebRTC + WebSocket** 的在线教育实时互动系统。

---

## 📋 功能特性

| 功能 | 说明 |
|------|------|
| 🖥️ 屏幕共享 | 老师可以实时共享屏幕给所有学生（WebRTC P2P） |
| 🎨 电子白板 | 支持画笔、橡皮擦、矩形、圆形、直线、文字等工具 |
| 🔒 屏幕锁定 | 老师可以锁定学生屏幕，让学生专心听讲 |
| 👁️ 学生监控 | 实时监控学生是否在专注听课 |
| 💬 实时聊天 | 课堂聊天互动 |
| 📹 音视频 | 摄像头和麦克风支持 |

---

## 🛠️ 技术栈

- **前端**: Nuxt3 + Vue3 + TailwindCSS
- **实时通信**: WebSocket (信令服务器)
- **音视频传输**: WebRTC (P2P)
- **白板**: Canvas API

---

## 📦 安装步骤

### 1. 安装依赖

```bash
npm install
```

### 2. 安装 WebSocket 库（如果还没安装）

```bash
npm install ws
```

---

## 🚀 运行步骤

### 步骤 1: 启动 WebSocket 信令服务器

打开一个终端，运行：

```bash
node server/ws-server.js
```

看到以下输出表示成功：
```
📡 WebSocket 信令服务器已启动，端口: 3001
```

### 步骤 2: 启动 Nuxt 开发服务器

打开另一个终端，运行：

```bash
npm run dev
```

看到以下输出表示成功：
```
Nuxt 3.x.x
  ➜ Local:    http://127.0.0.1:3000/
```

### 步骤 3: 访问系统

打开浏览器访问：**http://127.0.0.1:3000/classroom**

---

## 📖 使用说明

### 老师端操作

1. 访问 `http://127.0.0.1:3000/classroom`
2. 输入房间号（如 `test-room`）
3. 输入名字（如 `王老师`）
4. 点击 **「我是老师」** 进入教室

**老师可以：**
- 点击 **屏幕共享** 按钮分享屏幕给学生
- 在 **白板** 上绘图教学
- 查看 **学生监控** 面板了解学生状态
- **锁定/解锁** 学生屏幕
- 发送 **聊天消息**

### 学生端操作

1. 访问 `http://127.0.0.1:3000/classroom`
2. 输入**相同的房间号**（如 `test-room`）
3. 输入名字（如 `小明`）
4. 点击 **「我是学生」** 进入教室

**学生可以：**
- 观看老师的 **屏幕共享**
- 查看老师的 **白板绘图**
- 发送 **聊天消息**
- 被老师 **锁定屏幕** 时专心听讲

---

## 🧪 测试方法

### 推荐：使用两个不同的浏览器

为了避免标签页切换导致的焦点状态变化：

- **Chrome** → 老师端
- **Edge / Firefox** → 学生端

### 测试流程

1. 两边都进入**同一个房间**（房间号必须相同！）
2. 老师点击「屏幕共享」→ 学生端应能看到老师的屏幕
3. 老师在白板上画图 → 学生端实时同步显示
4. 老师点击「锁定学生」→ 学生端出现锁屏遮罩
5. 双方可以互相发送聊天消息

---

## ⚠️ 注意事项

### 1. 端口被占用

如果启动 WebSocket 服务器时报错 `EADDRINUSE`：

```bash
# 查找占用端口的进程
netstat -ano | findstr :3001

# 杀掉进程（替换 PID 为实际进程 ID）
taskkill /PID <PID> /F
```

或者修改 `server/ws-server.js` 中的端口号。

### 2. 摄像头/麦克风权限

首次使用时，浏览器会请求摄像头和麦克风权限，请点击「允许」。

如果没有摄像头，系统会显示默认头像，不影响其他功能。

### 3. 屏幕共享

- 屏幕共享使用 **WebRTC P2P** 技术
- 需要双方都在同一个局域网，或者配置 TURN 服务器
- 如果无法连接，可能是防火墙或 NAT 问题

### 4. HTTPS 要求

在生产环境部署时，必须使用 **HTTPS**，否则浏览器会阻止摄像头和屏幕共享功能。

本地开发时使用 `localhost` 或 `127.0.0.1` 不受此限制。

---

## 📁 项目结构

```
├── components/classroom/     # 教室组件
│   ├── Whiteboard.vue       # 电子白板
│   ├── VideoPlayer.vue      # 视频播放器
│   ├── ChatPanel.vue        # 聊天面板
│   ├── StudentMonitor.vue   # 学生监控
│   └── ScreenLockOverlay.vue # 屏幕锁定遮罩
├── composables/
│   ├── useWebSocket.ts      # WebSocket 封装
│   └── useWebRTC.ts         # WebRTC 封装
├── pages/classroom/
│   ├── index.vue            # 教室入口页
│   └── [roomId].vue         # 教室主页面
├── server/
│   └── ws-server.js         # WebSocket 信令服务器
└── docs/
    └── 在线教室系统使用指南.md  # 本文档
```

---

## 🔧 常见问题

### Q: 学生端看不到老师的屏幕共享？

1. 确保两边都在同一个房间
2. 检查学生端控制台是否有 `📥 收到远程视频流` 日志
3. 尝试刷新页面重新连接

### Q: 白板绘图不同步？

确保 WebSocket 服务器正在运行，检查页面左上角是否显示「已连接」。

### Q: 聊天消息发不出去？

同上，检查 WebSocket 连接状态。

---

## 📞 技术支持

如有问题，请检查：
1. WebSocket 服务器是否启动
2. 浏览器控制台是否有报错
3. 两端是否在同一个房间

---

**Happy Teaching! 🎉**

